# DDS 训练异常的根因说明

## 问题现象
- 训练 50 epoch 后，loss 下降但 `val_mAP@0.5` 和 `meanIoU` 近乎为 0，预测框在图 1/2/3 呈现“乱标注”。

## 直接原因（标注被静默丢弃）
- DDS 标注文件中实际存在 **6 个类别 id（0–5）**。例如 `Augmented_Data/train/labels/100_jpg.rf.0de758cbda471ed8e47e8c336796094c.txt` 的第一行就是类别 `5` 的框。
- 但旧版 `config.py` 将 `NUM_CLASSES` 设为 3，并在 `parse_yolo_annotation` 中对 `cls_idx >= NUM_CLASSES` 的框直接 `continue`，导致 **id ≥3 的框全部被跳过**。
- 这样一来，数据集中大部分目标在训练/验证时都不存在：
  - 训练损失仍能下降（模型只在少量“合法”框上收敛），
  - 但验证计算 mAP/IoU 时几乎找不到匹配框，于是指标接近 0，视觉上也表现为乱框。

## 现有修复
- 将默认类别数改为 6，并提供与 id 对应的占位名称，避免默认配置再次截断标签。【F:config.py†L47-L58】
- 解析标注时改为 **显式报错**（而不是静默跳过）当遇到超出 `NUM_CLASSES` 的 id，第一时间暴露配置-数据不匹配问题。【F:datasets/dental_dds.py†L20-L34】
- 在 README 中提示 DDS 默认含 6 类，使用前应确认并同步配置，避免误配。【F:README.md†L31-L35】

## 建议排查/使用方式
1. 如果你替换了自定义数据或精简了类别，务必同步修改 `NUM_CLASSES` 和 `CLASS_NAMES`，并确认标注文件里的最大 id 没有超出范围。
2. 运行一个快速 sanity check（例如读取几份标签并统计最大类 id），确认不会触发解析时的越界报错。
3. 若仍有 mAP 异常，继续检查 anchors、输入尺寸、以及评估时的置信度阈值，但首先确保“标签未被丢弃”这一根因已解决。
